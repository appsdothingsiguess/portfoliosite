---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// 1. Fetch Data from Content Collections
// These look for folders in src/content/research, src/content/journalism, etc.
const researchDocs = await getCollection('research');
const leadershipDocs = await getCollection('leadership');
const journalismDocs = await getCollection('journalism');
const businessDocs = await getCollection('business');

// 2. Sort Data (Newest first)
// We use optional chaining or fallback to empty arrays to prevent crashes if a folder is empty
const sortedResearch = (researchDocs || []).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const sortedJournalism = (journalismDocs || []).sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());
const sortedLeadership = (leadershipDocs || []).sort((a, b) => b.data.dateStart.valueOf() - a.data.dateStart.valueOf());
const sortedBusiness = (businessDocs || []).sort((a, b) => b.data.dateStart.valueOf() - a.data.dateStart.valueOf());
---

<BaseLayout title="Joseph Abboud | Researcher & Operator">
  
  <!-- Navigation -->
  <nav class="sticky top-0 z-50 border-b border-border bg-surface/95 backdrop-blur-md">
    <div class="max-w-5xl mx-auto px-6 h-16 flex items-center justify-between">
      <a href="./" class="font-serif font-bold text-xl tracking-tight">Joseph Abboud</a>
      
      <div class="flex items-center gap-3">
        <a href="#research" class="btn-secondary px-3 py-2 rounded-lg text-xs font-semibold inline-flex items-center gap-2">
          <i data-lucide="microscope" class="w-4 h-4"></i>
          <span class="hidden sm:inline">Research</span>
        </a>
        <a href="#contact" class="btn-primary px-3 py-2 rounded-lg text-xs font-semibold inline-flex items-center gap-2">
          <i data-lucide="message-square" class="w-4 h-4"></i>
          <span class="hidden sm:inline">Connect</span>
        </a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <header class="pt-16 pb-12 md:pt-24 md:pb-20 px-6 border-b border-border bg-gradient-to-b from-[var(--bg)] to-surface-2">
    <div class="max-w-5xl mx-auto flex flex-col-reverse md:flex-row items-center gap-10">
      
      <!-- Dynamic Text Content (Target for Chameleon Script) -->
      <div class="flex-1 text-center md:text-left">
        <div id="hero-badge" class="inline-flex items-center gap-2 px-3 py-1 rounded-full border border-border bg-surface mb-6 shadow-sm">
          <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
          <span class="text-xs font-medium text-muted">Targeting RBT & Research Roles</span>
        </div>
        
        <h1 id="hero-title" class="text-4xl md:text-5xl lg:text-6xl font-serif font-bold leading-[1.1] mb-6 text-balance text-[var(--text)]">
          Behavioral Science Researcher & <br class="hidden md:block"/> Operational Leader.
        </h1>
        
        <p id="hero-desc" class="text-lg text-muted leading-relaxed max-w-xl mx-auto md:mx-0 mb-8">
          I apply rigorous methodology to human behavior. With background in experimental design (E-Prime) and business operations, I bridge the gap between clinical protocol and execution.
        </p>

        <!-- Education Block -->
        <div class="mb-8 p-4 bg-surface border border-border rounded-xl inline-block text-left w-full md:w-auto shadow-sm">
          <div class="flex flex-col sm:flex-row gap-4 sm:items-center">
            <div class="flex items-center gap-3">
              <div class="bg-gray-100 p-2 rounded-lg">
                <i data-lucide="graduation-cap" class="w-6 h-6 text-muted"></i>
              </div>
              <div>
                <div class="font-bold text-[var(--text)]">Biola University</div>
                <div class="text-xs text-muted">B.A. Psychology</div>
              </div>
            </div>
            <div class="hidden sm:block w-px h-8 bg-border"></div>
            <div class="flex items-center gap-3">
              <div class="bg-yellow-50 p-2 rounded-lg">
                <i data-lucide="book-open" class="w-6 h-6 text-yellow-700"></i>
              </div>
              <div>
                <div class="font-bold text-[var(--text)]">Torrey Honors College</div>
                <div class="text-xs text-muted">Socratic Logic & Writing</div>
              </div>
            </div>
          </div>
        </div>

        <div class="flex flex-wrap justify-center md:justify-start gap-4">
          <!-- Point to your resume in public/assets/pdfs/ -->
          <a href="/assets/pdfs/resume.pdf" target="_blank" class="btn-secondary px-6 py-3 rounded-xl inline-flex items-center gap-2">
            <i data-lucide="file-text" class="w-4 h-4"></i> Download Resume
          </a>
        </div>
      </div>

      <!-- Headshot -->
      <div class="flex-shrink-0 relative group">
        <div class="w-48 h-48 md:w-64 md:h-64 rounded-full border-4 border-surface shadow-2xl overflow-hidden bg-gray-200 relative">
          <!-- Replace this URL with your local image path, e.g., /assets/images/joseph.jpg -->
          <img src="https://placehold.co/400x400/e2e8f0/475569?text=Joseph+Photo" alt="Joseph Abboud" class="w-full h-full object-cover">
        </div>
        <div class="absolute bottom-4 right-4 bg-surface px-3 py-1 rounded-full shadow-lg border border-border flex items-center gap-1.5 animate-bounce" style="animation-duration: 3s;">
          <span class="text-lg">ðŸ§ </span>
          <span class="text-xs font-bold">Psychology</span>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-6 space-y-20 py-16">

    <!-- Section: Technical Skills (Optimized for Recruiters) -->
    <section>
      <h3 class="text-sm font-bold uppercase tracking-wider text-muted mb-4">Technical Toolkit & Certifications</h3>
      <div class="flex flex-wrap gap-2">
        <span class="pill shadow-sm">SPSS Analysis</span>
        <span class="pill shadow-sm">E-Prime Design</span>
        <span class="pill shadow-sm">RBT / ABA Principles</span>
        <span class="pill shadow-sm">IRB Compliance</span>
        <span class="pill shadow-sm">Qualtrics</span>
        <span class="pill shadow-sm">Project Management (Asana)</span>
        <span class="pill shadow-sm">AP Style Writing</span>
        <span class="pill shadow-sm">Budget P&L</span>
      </div>
    </section>

    <!-- Section: Research (Dynamic) -->
    <section id="research" class="scroll-mt-24 transition-colors duration-1000 p-4 -m-4 rounded-2xl">
      <div class="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
        <div>
          <h2 class="text-3xl font-serif font-bold mb-2 flex items-center gap-2">
            <i data-lucide="microscope" class="w-6 h-6 text-muted"></i>
            Research & Psychology
          </h2>
          <p class="text-muted max-w-lg">Experimental design, protocol management, and data analysis.</p>
        </div>
      </div>

      <div class="space-y-6">
        {sortedResearch.map((item) => (
          <div class="card p-1">
            <details class="group open:bg-surface-2/30 rounded-xl transition-colors">
              <summary class="p-6 md:p-8 flex flex-col md:flex-row gap-6 cursor-pointer relative">
                <div class="flex-grow">
                  <div class="flex flex-wrap items-center gap-3 mb-2">
                    <h3 class="text-xl font-serif font-bold group-hover:text-info transition-colors">{item.data.title}</h3>
                    <span class="pill bg-yellow-50 text-yellow-800 border-yellow-200">{item.data.role}</span>
                  </div>
                  <p class="text-lg font-medium text-[var(--text)] mb-3">
                    {item.data.conference}
                  </p>
                  <p class="text-sm text-muted mb-4 leading-relaxed line-clamp-2">
                    {item.data.methodology || "Click to expand details..."}
                  </p>
                  <div class="flex items-center gap-2 text-sm font-semibold text-info">
                    <i data-lucide="chevron-down" class="w-4 h-4 group-open:rotate-180 transition-transform"></i>
                    <span class="group-open:hidden">View Methodology & Findings</span>
                    <span class="hidden group-open:inline">Hide details</span>
                  </div>
                </div>
                <div class="md:w-48 flex-shrink-0 md:border-l border-border md:pl-6 flex flex-col gap-3">
                  <span class="text-xs font-bold uppercase tracking-wider text-muted">Tools</span>
                  <div class="flex flex-wrap gap-2">
                    {item.data.tools.map((tool) => (
                      <span class="pill">{tool}</span>
                    ))}
                  </div>
                </div>
              </summary>
              <div class="px-6 pb-6 md:px-8 md:pb-8 pt-0 border-t border-border mt-2">
                <div class="grid md:grid-cols-2 gap-8 pt-6">
                  <div>
                    <h4 class="text-sm font-bold uppercase tracking-wide text-muted mb-3">Methodology</h4>
                    <p class="text-sm text-[var(--text)] leading-relaxed mb-4">
                      {item.data.methodology}
                    </p>
                    {item.data.posterUrl && (
                      <button onclick="document.getElementById('poster-modal').showModal()" class="btn-primary px-4 py-2 rounded-lg text-sm inline-flex items-center gap-2">
                        <i data-lucide="maximize-2" class="w-4 h-4"></i> View Poster PDF
                      </button>
                    )}
                  </div>
                  <div>
                     {item.data.findings && (
                      <>
                        <h4 class="text-sm font-bold uppercase tracking-wide text-muted mb-3">Key Findings</h4>
                        <ul class="list-disc pl-4 space-y-2 text-sm text-[var(--text)]">
                          {item.data.findings.map((point) => (
                            <li>{point}</li>
                          ))}
                        </ul>
                      </>
                    )}
                  </div>
                </div>
              </div>
            </details>
          </div>
        ))}
      </div>
    </section>

    <!-- Section: Business Ventures (Dynamic) -->
    {sortedBusiness.length > 0 && (
      <section id="business" class="scroll-mt-24 transition-colors duration-1000 p-4 -m-4 rounded-2xl">
        <div class="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
          <div>
            <h2 class="text-3xl font-serif font-bold mb-2 flex items-center gap-2">
              <i data-lucide="trending-up" class="w-6 h-6 text-muted"></i>
              Business Ventures
            </h2>
            <p class="text-muted max-w-lg">Building and operating profitable businesses.</p>
          </div>
        </div>

        <div class="grid md:grid-cols-3 gap-6">
          {sortedBusiness.map((item) => (
            <div class="md:col-span-3 card p-6 md:p-8">
              <div class="flex justify-between items-start">
                <div>
                  <h3 class="text-lg font-serif font-bold">{item.data.role}</h3>
                  <div class="text-sm text-muted">{item.data.organization} â€¢ {item.data.dateStart.getFullYear()} - {item.data.dateEnd ? item.data.dateEnd.getFullYear() : 'Present'}</div>
                </div>
                {item.data.tags && item.data.tags.length > 0 && (
                  <span class="pill">{item.data.tags[0]}</span>
                )}
              </div>
              <p class="mt-3 text-sm text-muted leading-relaxed">
                {item.data.summary}
              </p>
              {item.data.metrics && (
                <div class="mt-4 flex gap-4 border-t border-border pt-4">
                  {item.data.metrics.map((m) => (
                    <div>
                      <div class="text-lg font-bold font-serif">{m.value}</div>
                      <div class="text-xs text-muted uppercase">{m.label}</div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Section: Operations & Leadership (Dynamic) -->
    <section id="leadership" class="scroll-mt-24 transition-colors duration-1000 p-4 -m-4 rounded-2xl">
       <div class="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
        <div>
          <h2 class="text-3xl font-serif font-bold mb-2 flex items-center gap-2">
            <i data-lucide="briefcase" class="w-6 h-6 text-muted"></i>
            Operations & Leadership
          </h2>
          <p class="text-muted max-w-lg">Managing budgets, workflows, and teams.</p>
        </div>
      </div>

      <div class="grid md:grid-cols-3 gap-6">
        {sortedLeadership.map((item) => (
          <div class="md:col-span-3 card p-6 md:p-8">
            <div class="flex justify-between items-start">
              <div>
                <h3 class="text-lg font-serif font-bold">{item.data.role}</h3>
                <div class="text-sm text-muted">{item.data.organization} â€¢ {item.data.dateStart.getFullYear()} - {item.data.dateEnd ? item.data.dateEnd.getFullYear() : 'Present'}</div>
              </div>
              {item.data.tags && item.data.tags.length > 0 && (
                <span class="pill">{item.data.tags[0]}</span>
              )}
            </div>
            <p class="mt-3 text-sm text-muted leading-relaxed">
              {item.data.summary}
            </p>
             {item.data.metrics && (
              <div class="mt-4 flex gap-4 border-t border-border pt-4">
                {item.data.metrics.map((m) => (
                  <div>
                    <div class="text-lg font-bold font-serif">{m.value}</div>
                    <div class="text-xs text-muted uppercase">{m.label}</div>
                  </div>
                ))}
              </div>
            )}
          </div>
        ))}
      </div>
    </section>

    <!-- Section: Journalism (Dynamic) -->
    <section id="journalism" class="scroll-mt-24 transition-colors duration-1000 p-4 -m-4 rounded-2xl">
      <div class="flex flex-col md:flex-row md:items-end justify-between mb-8 gap-4">
        <div>
          <h2 class="text-3xl font-serif font-bold mb-2 flex items-center gap-2">
            <i data-lucide="newspaper" class="w-6 h-6 text-muted"></i>
            Journalism & Media
          </h2>
          <p class="text-muted max-w-lg">Investigative reporting and multimedia content.</p>
        </div>
        
        <div class="flex bg-surface border border-border rounded-full p-1">
          <button class="tab-btn active">All</button>
          <button class="tab-btn">Articles</button>
          <button class="tab-btn">Social</button>
        </div>
      </div>

      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
        {sortedJournalism.map((item, index) => (
          <article class="card p-1 flex flex-col h-full journalism-card rounded-xl transition-colors">
            <div class="p-6 flex flex-col h-full">
              {/* 1. Title - Most Prominent */}
              <h3 class="text-xl font-serif font-bold mb-3 leading-tight journalism-title transition-colors">
                <a href={item.data.url} class="hover:underline decoration-brand decoration-2 underline-offset-2 text-[var(--text)]" target="_blank">
                  {item.data.title}
                </a>
              </h3>
              
              {/* 2. Publication Badge + Year */}
              <div class="flex items-center justify-between mb-4">
                <span class={`pill ${item.data.type === 'Article' ? 'bg-blue-50 text-blue-800 border-blue-200' : 'bg-purple-50 text-purple-800 border-purple-200'}`}>
                  {item.data.type === 'Article' ? (
                    <>
                      <i data-lucide="file-text" class="w-3 h-3"></i>
                      <span>{item.data.publication || 'Article'}</span>
                    </>
                  ) : (
                    <>
                      <i data-lucide="instagram" class="w-3 h-3"></i>
                      <span>{item.data.publication || 'Social'}</span>
                    </>
                  )}
                </span>
                <span class="text-xs text-muted font-medium">{item.data.date.getFullYear()}</span>
              </div>
              
              {/* 3. Summary Preview (2-3 lines) */}
              <p class="text-muted text-sm mb-4 leading-relaxed line-clamp-2 flex-grow">
                {item.data.summary}
              </p>
              
              {/* 4. Toggle Indicator */}
              <div class="flex items-center justify-between mt-auto pt-3 border-t border-border">
                <a href={item.data.url} target="_blank" class="text-xs font-semibold flex items-center gap-1.5 hover:text-info transition-colors">
                  {item.data.type === 'Article' ? 'Read Article' : 'View Post'} 
                  <i data-lucide="external-link" class="w-3 h-3"></i>
                </a>
                <button 
                  onclick={`toggleCard('card-${index}', ${index})`}
                  class="flex items-center gap-2 text-xs font-semibold text-info journalism-toggle bg-transparent border-none cursor-pointer p-0"
                  aria-expanded="false"
                  aria-controls={`card-${index}`}
                >
                  <i data-lucide="chevron-down" class={`w-4 h-4 journalism-chevron-${index} transition-transform`}></i>
                  <span class={`journalism-toggle-text-more-${index}`}>Read more</span>
                  <span class={`journalism-toggle-text-less-${index} hidden`}>Less</span>
                </button>
              </div>
            </div>
            
            {/* 5. Expanded Content with Full Summary + Impact + External Link Button */}
            <div id={`card-${index}`} class="journalism-content px-6 pb-6 pt-0 border-t border-border mt-2 hidden">
              <div class="pt-4 space-y-4">
                <div>
                  <h4 class="text-sm font-bold uppercase tracking-wide text-muted mb-3">Summary</h4>
                  <p class="text-sm text-[var(--text)] leading-relaxed">
                    {item.data.summary}
                  </p>
                </div>
                {item.data.impact && (
                  <div>
                    <h4 class="text-sm font-bold uppercase tracking-wide text-muted mb-3">Impact</h4>
                    <p class="text-sm text-[var(--text)] leading-relaxed">
                      {item.data.impact}
                    </p>
                  </div>
                )}
                <div class="pt-3">
                  <a href={item.data.url} target="_blank" class="btn-primary px-5 py-2.5 rounded-lg text-sm inline-flex items-center gap-2 font-semibold">
                    <i data-lucide="external-link" class="w-4 h-4"></i>
                    {item.data.type === 'Article' ? 'Read Full Article' : 'View Full Post'}
                  </a>
                </div>
              </div>
            </div>
          </article>
        ))}
      </div>
    </section>

    <!-- Contact -->
    <section id="contact" class="mt-32 mb-10">
      <div class="bg-surface border border-border rounded-2xl p-10 md:p-16 text-center">
        <h2 class="text-3xl md:text-4xl font-bold mb-6">Let's Connect.</h2>
        <p class="text-muted max-w-xl mx-auto mb-8 text-lg">
          Currently available for RBT and Research Coordinator roles.
        </p>
        <div class="flex justify-center gap-4">
          <a href="https://linkedin.com/in/josephabboud" target="_blank" class="btn-primary px-8 py-4 rounded-xl text-lg inline-flex items-center gap-3 shadow-lg shadow-yellow-500/20">
            <i data-lucide="linkedin" class="w-5 h-5"></i>
            Connect on LinkedIn
          </a>
        </div>
      </div>
      <footer class="mt-16 text-center text-sm text-muted">
        <p>&copy; 2025 Joseph Abboud. Built with Astro & Tailwind.</p>
      </footer>
    </section>

  </main>

  <!-- Poster Modal -->
  <dialog id="poster-modal" class="backdrop:bg-gray-900/50 p-0 rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-hidden">
    <div class="flex flex-col h-full bg-surface">
      <div class="p-4 border-b border-border flex justify-between items-center bg-surface-2">
        <h3 class="font-bold">WPA 2025 Poster</h3>
        <form method="dialog"><button class="p-2 hover:bg-border rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button></form>
      </div>
      <div class="p-4 bg-gray-100 flex-grow overflow-auto flex justify-center items-center min-h-[400px]">
         <div class="text-center">
             <i data-lucide="file-image" class="w-16 h-16 text-muted mx-auto mb-4"></i>
             <p class="text-muted">Poster PDF would be embedded here.</p>
             <button class="mt-4 btn-secondary text-sm">Download PDF</button>
          </div>
      </div>
    </div>
  </dialog>

  <!-- Sticky Chameleon Script -->
  <script is:inline>
    // 1. Check URL params
    const params = new URLSearchParams(window.location.search);
    let currentMode = localStorage.getItem('portfolioMode');

    // 2. Set Mode (URL overrides storage)
    if (params.has('r')) currentMode = 'research';
    if (params.has('b')) currentMode = 'business';
    if (params.has('a')) currentMode = 'aba';
    if (params.has('j')) currentMode = 'journalism';

    // 3. Save to Storage
    if (currentMode) localStorage.setItem('portfolioMode', currentMode);

    // 4. Update UI
    const heroTitle = document.getElementById('hero-title');
    const heroDesc = document.getElementById('hero-desc');
    const heroBadge = document.getElementById('hero-badge');
    const researchSec = document.getElementById('research');
    const leadershipSec = document.getElementById('leadership');
    const journalismSec = document.getElementById('journalism');

    if (heroTitle && heroDesc && heroBadge) {
      if (currentMode === 'research') {
        heroBadge.innerHTML = '<span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span><span class="text-xs font-medium text-muted">Specializing in Experimental Design & Data</span>';
        heroTitle.innerHTML = 'Data-Driven Researcher & <br/> Psychology Graduate.';
        heroDesc.innerText = 'Leveraging E-Prime and SPSS to analyze behavioral patterns. Proven track record in protocol fidelity and participant management.';
        if(params.has('r')) {
           setTimeout(() => researchSec?.scrollIntoView({ behavior: 'smooth' }), 500);
           researchSec?.classList.add('animate-flash-focus');
        }

      } else if (currentMode === 'aba') {
        heroBadge.innerHTML = '<span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span><span class="text-xs font-medium text-muted">Targeting RBT & Behavior Tech Roles</span>';
        heroTitle.innerHTML = 'Behavior Technician & <br/> Clinical Support.';
        heroDesc.innerText = 'Implementing behavior intervention plans with fidelity. Experienced in data collection, pairing, and supporting clinical supervisors.';
        if(params.has('a')) {
           setTimeout(() => researchSec?.scrollIntoView({ behavior: 'smooth' }), 500);
           researchSec?.classList.add('animate-flash-focus');
        }

      } else if (currentMode === 'journalism') {
        heroBadge.innerHTML = '<span class="w-2 h-2 rounded-full bg-purple-500 animate-pulse"></span><span class="text-xs font-medium text-muted">Available for Editorial & Media Roles</span>';
        heroTitle.innerHTML = 'Investigative Journalist & <br/> Media Manager.';
        heroDesc.innerText = 'Asking the hard questions and verifying the facts. Experience managing newsrooms, editing copy, and producing multimedia content.';
        if(params.has('j')) {
           setTimeout(() => journalismSec?.scrollIntoView({ behavior: 'smooth' }), 500);
           journalismSec?.classList.add('animate-flash-focus');
        }

      } else if (currentMode === 'business') {
        heroBadge.innerHTML = '<span class="w-2 h-2 rounded-full bg-orange-500 animate-pulse"></span><span class="text-xs font-medium text-muted">Scaling Operations & Efficiency</span>';
        heroTitle.innerHTML = 'Operations Leader & <br/> Business Founder.';
        heroDesc.innerText = 'From 0 to 1. I build systems, optimize budgets, and lead teams to execute complex projects under deadline.';
        if(params.has('b')) {
           setTimeout(() => leadershipSec?.scrollIntoView({ behavior: 'smooth' }), 500);
           leadershipSec?.classList.add('animate-flash-focus');
        }
      }
    }
  </script>

  <!-- Journalism Card Toggle Script -->
  <script is:inline>
    function toggleCard(cardId, index) {
      const card = document.getElementById(cardId);
      const chevron = document.querySelector(`.journalism-chevron-${index}`);
      const textMore = document.querySelector(`.journalism-toggle-text-more-${index}`);
      const textLess = document.querySelector(`.journalism-toggle-text-less-${index}`);
      const button = chevron?.closest('button');
      const article = card?.closest('article');
      
      if (!card || !chevron || !textMore || !textLess) return;
      
      // Toggle hidden class on content
      card.classList.toggle('hidden');
      
      // Rotate chevron
      const isOpen = !card.classList.contains('hidden');
      if (isOpen) {
        chevron.style.transform = 'rotate(180deg)';
        textMore.classList.add('hidden');
        textLess.classList.remove('hidden');
        if (button) button.setAttribute('aria-expanded', 'true');
        if (article) article.classList.add('is-open');
      } else {
        chevron.style.transform = 'rotate(0deg)';
        textMore.classList.remove('hidden');
        textLess.classList.add('hidden');
        if (button) button.setAttribute('aria-expanded', 'false');
        if (article) article.classList.remove('is-open');
      }
    }
  </script>
</BaseLayout>